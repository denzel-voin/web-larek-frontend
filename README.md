# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Описание данных

### IProductItem

Интерфейс продукта, который приходят от сервера.

- <code>id</code> - уникальный номер.
- <code>description</code> - описание продукта.
- <code>image</code> - картинка продукта.
- <code>title</code> - заголовок продукта.
- <code>category</code> - категория продукта.
- <code>price</code> - цена продукта.

### IBasket

Интерфейс корзины, которая содержит список товаров.

- <code>items</code> - продукты в корзине.
- <code>total</code> - общая стоимость продуктов.

### IOrder

Интерфейс полей для заказа.

- <code>payment</code> - способ оплаты.
- <code>email</code> - электронная почта.
- <code>phone</code> - номер телефона.
- <code>address</code> - адрес отправки.
- <code>items</code> - продукты для заказа.
- <code>total</code> - стоимость заказа.

### IOrderResult

Интерфейс для созданного заказа и списанной суммы.

- <code>id</code> - уникальный номер.
- <code>total</code> - списанная сумма.

### OrderForm

Форма валидации.

- <code>payment</code> - способ оплаты.
- <code>email</code> - электронная почта.
- <code>phone</code> - номер телефона.
- <code>address</code> - адрес отправки.

### PaymentMethod

Тип в котором содержатся методы оплаты.

- <code>'cash'</code> - оплата наличными.
- <code>'card'</code> - оплата банковской картой.

### IWebLarekAPI

Интерфейс описывающий методы получения данных с сервера.

- <code>getProductList: () => Promise<IProductItem[]></code> - Метод для получения списка продуктов, который возвращает промис с массивом продуктов.
- <code>getProductItem: (id: string) => Promise<IProductItem></code> - Метод для получения информации о конкретном продукте по его идентификатору, возвращает промис с продуктом.
- <code>orderProducts: (order: IOrder) => Promise<IOrderResult></code> - Метод для оформления заказа, который принимает заказ и возвращает промис с результатом.

### IEvents

Интерфейс созданный для брокера событий.

- <code>on</code> - метод для подписки на события.
- <code>emit</code> - метод для генерации (триггера) событий.
- <code>trigger</code> - метод для генерации события с возможностью задания контекста.

### Интерфейсы для отображения моделей данных

### IModalData

#### Интерфейс содержит:

- <code>content</code> - контент в виде DOM-разметки.

### IFormState

Интерфейс для отслеживания валидности введенных пользователем данных.

- <code>valid</code> - отображает прошла ли валидация.
- <code>errors</code> - собирает ошибки.

### IPage

#### Интерфейс содержит:

- <code>counter</code> - счетчик товаров в корзине.
- <code>catalog</code> - каталог товаров в виде DOM-разметки.
- <code>locked</code> - будет блокировать прокрутку страницы.

### Класс <code>Api</code>

Класс `Api` предоставляет базовые методы для выполнения HTTP-запросов. В этом классе используются методы `GET` и `POST` для взаимодействия с API, а также есть методы для обработки ответов.

#### Свойства:

- `baseUrl` - базовый URL для всех запросов.
- `options` - опции запроса по умолчанию.

#### Конструктор:

- Принимает `baseUrl` и `options`.
- Инициализирует `baseUrl` и объединяет переданные заголовки с заголовками по умолчанию.

#### Методы:

- `handleResponse` - обрабатывает ответ от сервера.
    - **Параметры:**
        - `response` (`Response`): Ответ от сервера.
    - **Возвращаемое значение:**
        - `Promise<object>`: Промис с данными ответа или ошибкой.
- `get` - выполняет `GET` запрос по указанному URL.
    - **Параметры:**
        - `uri` (`string`): URI для запроса.
    - **Возвращаемое значение:**
        - `Promise<object>`: Промис с данными ответа.
- `post` - выполняет запрос по указанному URI с методом (по умолчанию `'POST'`) и телом запроса.
    - **Параметры:**
        - `uri` (`string`): URI для запроса.
        - `data` (`object`): Данные для отправки в теле запроса.
        - `method` (`ApiPostMethods`, опционально): HTTP метод (по умолчанию `'POST'`).
    - **Возвращаемое значение:**
        - `Promise<object>`: Промис с данными ответа.

### Класс <code>WebLarekAPI</code>

Наследует класс <code>Api</code> и реализует интерфейс <code>IWebLarekAPI</code>. Предоставляет методы для взаимодействия с веб-API для работы с продуктами и заказами.

#### Конструктор

Конструктор класса принимает URL-адрес хоста `cdn`, базовый URL-адрес `baseUrl` и опции для запроса `options`. В конструкторе вызывается конструктор родительского класса <code>Api</code> с переданными параметрами.

#### Методы

- <code>getProductList</code>: Выполняет запрос для получения списка продуктов и обрабатывает полученные данные, добавляя к каждому элементу ссылку на изображение.
    - **Возвращаемое значение:**
        - `Promise<IProductItem[]>`: Промис с массивом объектов типа `IProductItem`.
    - **Описание**:
        - Выполняет `GET` запрос по URI `/product`.
        - Обрабатывает полученные данные, добавляя к каждому элементу ссылку на изображение с использованием базового URL `cdn`.

- <code>getProductItem</code>: Выполняет запрос для получения информации о конкретном продукте по его идентификатору и обрабатывает полученные данные, добавляя ссылку на изображение.
    - **Параметры:**
        - `id` (`string`): Идентификатор продукта.
    - **Возвращаемое значение:**
        - `Promise<IProductItem>`: Промис с объектом типа `IProductItem`.
    - **Описание**:
        - Выполняет `GET` запрос по URI `/product/{id}`.
        - Обрабатывает полученные данные, добавляя ссылку на изображение с использованием базового URL `cdn`.

- <code>orderProducts</code>: Выполняет запрос на оформление заказа и возвращает результат оформления.
    - **Параметры:**
        - `order` (`IOrder`): Объект заказа.
    - **Возвращаемое значение:**
        - `Promise<IOrderResult>`: Промис с результатом оформления заказа.
    - **Описание**:
        - Выполняет `POST` запрос по URI `/order` с данными заказа.

### Класс <code>Component`<T>`</code>

Базовый абстрактный класс, предназначенный для управления компонентом. Предоставляет методы для работы с DOM-элементами и рендеринга данных.

#### Конструктор

- Принимает один параметр:
    - `container` (`HTMLElement`): Контейнер, в котором компонент будет рендериться.

#### Методы

- `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс у указанного элемента.
    - **Параметры:**
        - `element` (`HTMLElement`): Элемент, у которого нужно переключить класс.
        - `className` (`string`): Имя класса, который нужно переключить.
        - `force` (`boolean`, опционально): Если передано, принудительно добавляет или удаляет класс.

- `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое для указанного элемента.
    - **Параметры:**
        - `element` (`HTMLElement`): Элемент, текстовое содержимое которого нужно установить.
        - `value` (`unknown`): Значение, которое нужно установить в качестве текста.

- `setDisabled(element: HTMLElement, state: boolean)`: Включает или отключает элемент.
    - **Параметры:**
        - `element` (`HTMLElement`): Элемент, состояние которого нужно изменить.
        - `state` (`boolean`): Если `true`, элемент будет отключен; если `false`, элемент будет включен.

- `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает источник и альтернативный текст для изображения.
    - **Параметры:**
        - `element` (`HTMLImageElement`): Изображение, для которого нужно установить источник и альтернативный текст.
        - `src` (`string`): Источник изображения.
        - `alt` (`string`, опционально): Альтернативный текст изображения.

- `render(data?: Partial<T>): HTMLElement`: Обновляет данные компонента и возвращает контейнер компонента.
    - **Параметры:**
        - `data` (`Partial<T>`, опционально): Данные для обновления компонента.
    - **Возвращаемое значение:**
        - `HTMLElement`: Контейнер компонента, возможно обновленный.

### Класс <code>View`<T>`</code>

Класс `View<T>` наследуется от класса `Component<T>` и добавляет поле `events` типа `IEvents`, которое используется для управления событиями компонента.

#### Конструктор

Конструктор класса `View<T>` принимает два параметра:

- `container` (`HTMLElement`): Контейнер, в котором компонент будет рендериться. Передается в конструктор родительского класса `Component<T>`.
- `events` (`IEvents`): Интерфейс для управления событиями компонента.

#### Наследуемые методы

Класс `View<T>` наследует методы от класса `Component<T>`, включая:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)`
- `setText(element: HTMLElement, value: unknown)`
- `setDisabled(element: HTMLElement, state: boolean)`
- `setImage(element: HTMLImageElement, src: string, alt?: string)`
- `render(data?: Partial<T>): HTMLElement`

Эти методы позволяют управлять классами, текстом, состоянием, изображениями и рендерингом элемента.

### Компоненты представления

### Класс <code>Basket</code>

Класс `Basket` наследуется от класса `View<IBasket>` и представляет собой компонент корзины покупок. Он управляет отображением списка товаров, общей суммой и состоянием кнопки для оформления заказа.

#### Свойства

- **`static template`** (`HTMLTemplateElement`): Шаблон для создания контейнера корзины. Используется метод `ensureElement` для получения элемента шаблона.

- **`_list`** (`HTMLElement`): Элемент, представляющий список товаров в корзине.

- **`_total`** (`HTMLElement`): Элемент, показывающий общую стоимость товаров в корзине.

- **`_button`** (`HTMLElement`): Кнопка для оформления заказа.

#### Конструктор

- Принимает один параметр:
    - `events` (`EventEmitter`): Интерфейс для управления событиями, используемый для обработки событий, таких как открытие заказа.

- В конструкторе:
    - Клонируется шаблон корзины и передается в конструктор родительского класса `View<T>`.
    - Инициализируются свойства `_list`, `_total` и `_button`.
    - Добавляется обработчик события на кнопку, который вызывает событие `order:open`.

#### Методы

- **`set items(items: HTMLElement[])`**: Устанавливает список товаров в корзине.
    - **Параметры:**
        - `items` (`HTMLElement[]`): Массив элементов, представляющих товары.
    - **Описание:**
        - Если массив `items` не пустой, заменяет содержимое элемента `_list` на предоставленные элементы и включает кнопку оформления заказа.
        - Если массив пустой, заменяет содержимое `_list` на сообщение "Корзина пуста" и отключает кнопку оформления заказа.

- **`set selected(items: string[])`**: Устанавливает состояние кнопки оформления заказа в зависимости от выбранных товаров.
    - **Параметры:**
        - `items` (`string[]`): Массив идентификаторов выбранных товаров.
    - **Описание:**
        - Если массив `items` не пустой, включает кнопку оформления заказа.
        - Если массив пустой, отключает кнопку оформления заказа.

- **`set total(total: number)`**: Устанавливает общую стоимость товаров в корзине.
    - **Параметры:**
        - `total` (`number`): Общая стоимость товаров.
    - **Описание:**
        - Обновляет текст элемента `_total`, отображая стоимость в формате "X синапсов".

### Класс <code>Form`<T>`</code>

Класс `Form<T>` наследуется от класса `View<IFormState>` и представляет собой компонент формы с поддержкой валидации и обработки событий.

#### Свойства

- **`_submit`** (`HTMLButtonElement`): Кнопка отправки формы.

- **`_errors`** (`HTMLElement`): Элемент для отображения сообщений об ошибках.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLFormElement`): HTML-форма, в которой рендерится компонент.
    - `events` (`EventEmitter`): Интерфейс для управления событиями, используемый для обработки событий формы.

- В конструкторе:
    - Инициализируются свойства `_submit` и `_errors` с помощью функции `ensureElement`.
    - Добавляются обработчики событий:
        - `input`: Обрабатывает изменения в полях формы и вызывает метод `onInputChange`.
        - `submit`: Предотвращает стандартное поведение отправки формы и вызывает событие с именем `${this.container.name}:submit`.

#### Методы

- **`protected onInputChange(field: keyof T, value: string)`**: Обрабатывает изменения в полях формы и вызывает соответствующее событие.
    - **Параметры:**
        - `field` (`keyof T`): Имя поля, значение которого изменилось.
        - `value` (`string`): Новое значение поля.
    - **Описание:**
        - Вызывает событие с именем `${this.container.name}.${String(field)}:change`, передавая объект с полем и значением.

- **`set valid(value: boolean)`**: Устанавливает состояние кнопки отправки формы (активна/неактивна).
    - **Параметры:**
        - `value` (`boolean`): Если `true`, кнопка становится активной; если `false`, кнопка становится неактивной.

- **`set errors(value: string)`**: Устанавливает текст сообщения об ошибках.
    - **Параметры:**
        - `value` (`string`): Сообщение об ошибках для отображения в элементе `_errors`.

- **`render(state: Partial<T> & IFormState)`**: Обновляет состояние формы и возвращает контейнер формы.
    - **Параметры:**
        - `state` (`Partial<T> & IFormState`): Частичное состояние формы, включая данные формы и состояние валидации.
    - **Возвращаемое значение:**
        - `HTMLElement`: Контейнер формы, возможно обновленный.

### Класс <code>Modal</code>

Класс `Modal` наследуется от класса `View<IModalData>` и представляет собой модальное окно с поддержкой открытия и закрытия.

#### Свойства

- **`_closeButton`** (`HTMLButtonElement`): Кнопка для закрытия модального окна.

- **`_content`** (`HTMLElement`): Элемент, содержащий контент модального окна.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLElement`): Контейнер, в котором будет отображаться модальное окно. Передается в конструктор родительского класса `View<IModalData>`.
    - `events` (`IEvents`): Интерфейс для управления событиями, используемый для обработки событий открытия и закрытия модального окна.

- В конструкторе:
    - Инициализируются свойства `_closeButton` и `_content` с помощью функции `ensureElement`.
    - Добавляются обработчики событий:
        - `click` на кнопку закрытия (`_closeButton`): Закрывает модальное окно.
        - `mousedown` на контейнер (`container`): Закрывает модальное окно при клике вне области контента.
        - `mousedown` на контент (`_content`): Останавливает распространение события, чтобы клики внутри контента не вызывали закрытие модального окна.

#### Методы

- **`set content(value: HTMLElement)`**: Устанавливает содержимое модального окна.
    - **Параметры:**
        - `value` (`HTMLElement`): Новый элемент контента для модального окна.
    - **Описание:**
        - Заменяет текущее содержимое элемента `_content` на новый элемент `value`.

- **`open()`**: Открывает модальное окно.
    - **Описание:**
        - Добавляет класс `modal_active` к контейнеру, чтобы сделать модальное окно видимым.
        - Вызывает событие `modal:open`.

- **`close()`**: Закрывает модальное окно.
    - **Описание:**
        - Удаляет класс `modal_active` из контейнера, чтобы скрыть модальное окно.
        - Очищает содержимое модального окна, устанавливая его в `null`.
        - Вызывает событие `modal:close`.

### Класс <code>Page</code>

Класс `Page` наследуется от класса `View<IPage>` и представляет собой компонент страницы с элементами управления корзиной, счетчиком и каталогом.

#### Свойства

- **`_counter`** (`HTMLElement`): Элемент, отображающий счетчик товаров в корзине.

- **`_catalog`** (`HTMLElement`): Элемент, содержащий каталог товаров.

- **`_wrapper`** (`HTMLElement`): Элемент-обертка страницы, который может быть заблокирован.

- **`_basket`** (`HTMLElement`): Элемент, представляющий корзину, с обработчиком клика для открытия корзины.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLElement`): Контейнер, в котором будет рендериться компонент. Передается в конструктор родительского класса `View<IPage>`.
    - `events` (`IEvents`): Интерфейс для управления событиями, используемый для обработки событий, таких как открытие корзины.

- В конструкторе:
    - Инициализируются свойства `_counter`, `_catalog`, `_wrapper` и `_basket` с помощью функции `ensureElement`.
    - Добавляется обработчик события `click` на элемент `_basket`, который вызывает событие `basket:open`.

#### Методы

- **`set counter(value: number)`**: Устанавливает значение счетчика товаров в корзине.
    - **Параметры:**
        - `value` (`number`): Новое значение счетчика.
    - **Описание:**
        - Обновляет текст элемента `_counter`, отображая значение `value`.

- **`set catalog(items: HTMLElement[])`**: Устанавливает содержимое каталога товаров.
    - **Параметры:**
        - `items` (`HTMLElement[]`): Массив элементов, представляющих товары в каталоге.
    - **Описание:**
        - Заменяет текущее содержимое элемента `_catalog` на новые элементы `items`.

- **`set locked(value: boolean)`**: Устанавливает состояние блокировки страницы.
    - **Параметры:**
        - `value` (`boolean`): Если `true`, добавляется класс `page__wrapper_locked` к элементу `_wrapper`, блокируя страницу; если `false`, класс удаляется, разблокируя страницу.
    - **Описание:**
        - Добавляет или удаляет класс `page__wrapper_locked` в зависимости от значения `value`.

### Класс <code>Card</code>

Класс `Card` наследуется от класса `Component<IProductItem>` и представляет собой компонент карточки продукта с поддержкой различных свойств и действий.

#### Свойства

- **`_category`** (`HTMLElement` | `undefined`): Элемент, отображающий категорию продукта.

- **`_title`** (`HTMLElement`): Элемент, отображающий заголовок продукта.

- **`_image`** (`HTMLImageElement` | `undefined`): Элемент изображения продукта.

- **`_description`** (`HTMLElement` | `undefined`): Элемент, отображающий описание продукта.

- **`_price`** (`HTMLElement`): Элемент, отображающий цену продукта.

- **`_button`** (`HTMLButtonElement` | `undefined`): Элемент кнопки действия на карточке.

- **`_categoryColor`** (`Map<string, string>`): Карта соответствия категорий и классов стилей.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLElement`): Контейнер, в котором будет рендериться карточка.
    - `actions` (`ICardActions` | `undefined`): Объект с обработчиком кликов. Если передан, то добавляется обработчик события `click` на кнопку или контейнер.

- В конструкторе:
    - Инициализируются свойства `_title`, `_price`, `_category`, `_image`, `_description` и `_button` с помощью функции `ensureElement`.
    - Если передан объект `actions` с методом `onClick`, добавляется обработчик кликов на кнопку или контейнер.

#### Методы

- **`set id(value: string)`**: Устанавливает идентификатор карточки.
    - **Параметры:**
        - `value` (`string`): Значение идентификатора.
    - **Описание:**
        - Устанавливает значение атрибута `data-id` контейнера.

- **`get id(): string`**: Получает идентификатор карточки.
    - **Возвращаемое значение:**
        - `string`: Значение атрибута `data-id` контейнера или пустая строка, если идентификатор не установлен.

- **`set title(value: string)`**: Устанавливает заголовок карточки.
    - **Параметры:**
        - `value` (`string`): Новый заголовок.
    - **Описание:**
        - Обновляет текст элемента `_title`.

- **`get title(): string`**: Получает заголовок карточки.
    - **Возвращаемое значение:**
        - `string`: Текстовое содержимое элемента `_title` или пустая строка, если заголовок не установлен.

- **`set image(value: string)`**: Устанавливает изображение карточки.
    - **Параметры:**
        - `value` (`string`): URL изображения.
    - **Описание:**
        - Устанавливает источник изображения и альтернативный текст для элемента `_image`.

- **`get price(): string`**: Получает цену продукта.
    - **Возвращаемое значение:**
        - `string`: Текстовое содержимое элемента `_price` или пустая строка, если цена не установлена.

- **`set price(value: string)`**: Устанавливает цену продукта.
    - **Параметры:**
        - `value` (`string`): Новое значение цены.
    - **Описание:**
        - Обновляет текст элемента `_price` и делает кнопку действия активной или неактивной в зависимости от наличия значения `value`.

- **`get category(): string`**: Получает категорию продукта.
    - **Возвращаемое значение:**
        - `string`: Текстовое содержимое элемента `_category` или пустая строка, если категория не установлена.

- **`set category(value: string)`**: Устанавливает категорию продукта.
    - **Параметры:**
        - `value` (`string`): Новое значение категории.
    - **Описание:**
        - Обновляет текст элемента `_category` и изменяет класс стиля в зависимости от категории.

- **`set description(value: string)`**: Устанавливает описание карточки.
    - **Параметры:**
        - `value` (`string`): Новый текст описания.
    - **Описание:**
        - Обновляет текст элемента `_description`.

- **`set button(value: string)`**: Устанавливает текст кнопки действия.
    - **Параметры:**
        - `value` (`string`): Новый текст кнопки.
    - **Описание:**
        - Обновляет текст элемента `_button`.

### Класс <code>Order</code>

Класс `Order` наследуется от класса `Form<OrderForm>` и представляет собой компонент формы заказа, с поддержкой выбора метода оплаты и ввода адреса.

#### Свойства

- **`_paymentCard`** (`HTMLButtonElement`): Кнопка для выбора оплаты картой.

- **`_paymentCash`** (`HTMLButtonElement`): Кнопка для выбора оплаты наличными.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLFormElement`): Форма, в которой будет рендериться компонент заказа.
    - `events` (`EventEmitter`): Интерфейс для управления событиями, используемый для обработки изменений формы.

- В конструкторе:
    - Инициализируются свойства `_paymentCard` и `_paymentCash` с помощью функции `ensureElement`.
    - Добавляются обработчики кликов на кнопки `_paymentCard` и `_paymentCash`, которые устанавливают метод оплаты и вызывают метод `onInputChange` для уведомления об изменении.

#### Методы

- **`set address(value: string)`**: Устанавливает значение поля адреса в форме.
    - **Параметры:**
        - `value` (`string`): Новый адрес.
    - **Описание:**
        - Находит элемент формы с именем `address` и устанавливает его значение в `value`.

- **`set payment(value: PaymentMethod)`**: Устанавливает выбранный метод оплаты и обновляет внешний вид кнопок.
    - **Параметры:**
        - `value` (`PaymentMethod`): Новый метод оплаты. Может быть `'card'` или `'cash'`.
    - **Описание:**
        - Обновляет активное состояние кнопок `_paymentCard` и `_paymentCash` в зависимости от выбранного метода оплаты. Кнопка с выбранным методом получает класс `button_alt-active`.

### Класс <code>Contacts</code>

Класс `Contacts` наследуется от класса `Form<OrderForm>` и представляет собой компонент формы для ввода контактной информации, такой как электронная почта и телефон.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLFormElement`): Форма, в которой будет рендериться компонент контактной информации.
    - `events` (`EventEmitter`): Интерфейс для управления событиями, используемый для обработки изменений формы.

- В конструкторе:
    - Вызывается конструктор родительского класса `Form` для инициализации формы и событий.

#### Методы

- **`set email(value: string)`**: Устанавливает значение поля электронной почты в форме.
    - **Параметры:**
        - `value` (`string`): Новый адрес электронной почты.
    - **Описание:**
        - Находит элемент формы с именем `email` и устанавливает его значение в `value`.

- **`set phone(value: string)`**: Устанавливает значение поля телефона в форме.
    - **Параметры:**
        - `value` (`string`): Новый номер телефона.
    - **Описание:**
        - Находит элемент формы с именем `phone` и устанавливает его значение в `value`.

### Класс <code>Success</code>

Класс `Success` наследуется от класса `Component<IOrderResult>` и представляет собой компонент, отображающий сообщение об успешном оформлении заказа, включая общую сумму и кнопку для закрытия сообщения.

#### Конструктор

- Принимает два параметра:
    - `container` (`HTMLFormElement`): Форма, в которой будет рендериться компонент успешного оформления заказа.
    - `actions` (`ISuccessActions`, необязательный): Интерфейс для управления действиями, используемыми для обработки кликов.

- В конструкторе:
    - Инициализируются свойства `_total` и `_close` с помощью функции `ensureElement`.
    - Если в `actions` передан метод `onClick`, то добавляется обработчик события `click` для кнопки `_close`, или для контейнера, если кнопка отсутствует.

#### Свойства

- **`_total`** (`HTMLElement`): Элемент, отображающий общую сумму, списанную со счета.

- **`_close`** (`HTMLButtonElement`): Кнопка для закрытия сообщения об успешном заказе.

#### Методы

- **`set total(value: number)`**: Устанавливает значение общей суммы, списанной со счета.
    - **Параметры:**
        - `value` (`number`): Сумма, списанная со счета.
    - **Описание:**
        - Обновляет текст элемента `_total`, отображая сумму с форматом `Списано {value} синапсов`.

### Класс <code>AppData</code>

Класс `AppData` управляет состоянием приложения, включая список продуктов, корзину, предварительный просмотр товара, заказ и ошибки формы. Он взаимодействует с событиями через интерфейс `IEvents` для обновления состояния и уведомления об изменениях.

#### Свойства

- **`items`** (`IProductItem[]`): Массив товаров, доступных в приложении.

- **`basket`** (`IBasket`): Корзина покупок, содержащая список идентификаторов товаров и общую стоимость.

- **`preview`** (`IProductItem`): Товар, выбранный для предварительного просмотра.

- **`order`** (`IOrder`): Заказ, содержащий информацию о покупателе, способе оплаты, и товарах.

- **`formErrors`** (`Partial<Record<keyof OrderForm, string>>`): Объект, содержащий ошибки формы заказа.

#### Конструктор

- Принимает один параметр:
    - `events` (`IEvents`): Интерфейс для управления событиями, используемый для оповещения об изменениях в состоянии приложения.

#### Методы

- **`setItems(items: IProductItem[])`**: Устанавливает список товаров и генерирует событие `items:change`.
    - **Параметры:**
        - `items` (`IProductItem[]`): Новый список товаров.

- **`setPreview(item: IProductItem)`**: Устанавливает предварительный просмотр товара и генерирует событие `preview:change`.
    - **Параметры:**
        - `item` (`IProductItem`): Товар для предварительного просмотра.

- **`inBasket(item: IProductItem)`**: Проверяет, находится ли товар в корзине.
    - **Параметры:**
        - `item` (`IProductItem`): Товар для проверки.
    - **Возвращает:**
        - `boolean`: `true`, если товар в корзине, иначе `false`.

- **`addToBasket(item: IProductItem)`**: Добавляет товар в корзину и генерирует событие `basket:change`.
    - **Параметры:**
        - `item` (`IProductItem`): Товар для добавления.

- **`removeFromBasket(item: IProductItem)`**: Удаляет товар из корзины и генерирует событие `basket:change`.
    - **Параметры:**
        - `item` (`IProductItem`): Товар для удаления.

- **`clearBasket()`**: Очищает корзину и генерирует событие `basket:change`.

- **`setPaymentMethod(method: PaymentMethod)`**: Устанавливает способ оплаты для заказа.
    - **Параметры:**
        - `method` (`PaymentMethod`): Способ оплаты.

- **`setOrderField(field: keyof OrderForm, value: string)`**: Устанавливает значение поля заказа и обновляет информацию о корзине в заказе, если форма валидна.
    - **Параметры:**
        - `field` (`keyof OrderForm`): Поле заказа для обновления.
        - `value` (`string`): Новое значение поля.

- **`validateOrder()`**: Валидирует поля заказа и генерирует событие `formErrors:change` с ошибками формы. Возвращает `true`, если форма валидна, иначе `false`.
    - **Возвращает:**
        - `boolean`: `true`, если форма валидна, иначе `false`.

## Описание событий.

### Класс <code>EventEmitter</code>

Класс `EventEmitter` является классом-посредником (Presenter) между классами отображения (View) и классом модели данных (Model). Он реализует интерфейс <code>IEvents</code> и предоставляет методы для управления событиями в приложении.

Конструктор класса не принимает параметров.

#### Свойства

- **`_events`** (`Map<EventName, Set<Subscriber>>`)
    - Переменная, которая хранит подписки на события. Ключами являются имена событий (строки или регулярные выражения), значениями — множества подписчиков.

#### Методы

- **`on<T extends object>(eventName: EventName, callback: (data: T) => void): void`**
    - Устанавливает обработчик для указанного события.
    - **Параметры:**
        - `eventName` (`EventName`): Имя события (строка или регулярное выражение).
        - `callback` (`(data: T) => void`): Функция-обработчик, вызываемая при возникновении события.

- **`off(eventName: EventName, callback: Subscriber): void`**
    - Снимает обработчик с указанного события.
    - **Параметры:**
        - `eventName` (`EventName`): Имя события (строка или регулярное выражение).
        - `callback` (`Subscriber`): Функция-обработчик для отмены подписки.

- **`emit<T extends object>(eventName: string, data?: T): void`**
    - Инициирует событие с переданными данными.
    - **Параметры:**
        - `eventName` (`string`): Имя события.
        - `data` (`T`): Данные события (опционально).

- **`onAll(callback: (event: EmitterEvent) => void): void`**
    - Подписывается на все события, включая шаблонные.
    - **Параметры:**
        - `callback` (`(event: EmitterEvent) => void`): Функция-обработчик для всех событий.

- **`offAll(): void`**
    - Очищает все подписки на события.

- **`trigger<T extends object>(eventName: string, context?: Partial<T>): (event: object) => void`**
    - Создаёт функцию-триггер, которая инициирует событие с контекстными данными.
    - **Параметры:**
        - `eventName` (`string`): Имя события.
        - `context` (`Partial<T>`): Контекстные данные события (опционально).
    - **Возвращает:**
        - `(event: object) => void`: Функция-триггер, которая вызывает событие с контекстными данными.
